-- Use existing database
CREATE DATABASE IF NOT EXISTS hospital_db;
USE hospital_db;

-- Drop tables if already exist (to avoid errors)
DROP TABLE IF EXISTS Appointment;
DROP TABLE IF EXISTS Patient;
DROP TABLE IF EXISTS Doctor;
DROP TABLE IF EXISTS Department;

-- Create Department Table
CREATE TABLE Department (
    department_id INT PRIMARY KEY AUTO_INCREMENT,
    department_name VARCHAR(100) NOT NULL
);

-- Create Doctor Table
CREATE TABLE Doctor (
    doctor_id INT PRIMARY KEY AUTO_INCREMENT,
    doctor_name VARCHAR(100) NOT NULL,
    department_id INT,
    FOREIGN KEY (department_id) REFERENCES Department(department_id)
);

-- Create Patient Table
CREATE TABLE Patient (
    patient_id INT PRIMARY KEY AUTO_INCREMENT,
    patient_name VARCHAR(100) NOT NULL,
    age INT,
    phone VARCHAR(15)
);

-- Create Appointment Table
CREATE TABLE Appointment (
    appointment_id INT PRIMARY KEY AUTO_INCREMENT,
    patient_id INT,
    doctor_id INT,
    appointment_date DATETIME,
    status VARCHAR(50),
    FOREIGN KEY (patient_id) REFERENCES Patient(patient_id),
    FOREIGN KEY (doctor_id) REFERENCES Doctor(doctor_id)
);

-- Insert Sample Data

INSERT INTO Department (department_name)
VALUES ('Cardiology'), ('Neurology'), ('Orthopedics');

INSERT INTO Doctor (doctor_name, department_id)
VALUES ('Dr. Sharma', 1),
       ('Dr. Mehta', 2),
       ('Dr. Rao', 3);

INSERT INTO Patient (patient_name, age, phone)
VALUES ('Ravi', 25, '9876543210'),
       ('Anita', 30, '9123456780'),
       ('Kiran', 40, '9988776655');

INSERT INTO Appointment (patient_id, doctor_id, appointment_date, status)
VALUES (1, 1, '2026-03-01 10:00:00', 'Scheduled'),
       (2, 2, '2026-03-05 12:00:00', 'Scheduled'),
       (3, 1, '2026-03-10 09:00:00', 'Completed');

-- =========================
-- REQUIRED OUTPUT QUERIES
-- =========================

-- 1. List appointments for a doctor (Doctor ID = 1)
SELECT a.appointment_id, p.patient_name, a.appointment_date, a.status
FROM Appointment a
JOIN Patient p ON a.patient_id = p.patient_id
WHERE a.doctor_id = 1;

-- 2. Count patients per department
SELECT d.department_name, COUNT(DISTINCT a.patient_id) AS total_patients
FROM Department d
JOIN Doctor doc ON d.department_id = doc.department_id
JOIN Appointment a ON doc.doctor_id = a.doctor_id
GROUP BY d.department_name;

-- 3. Show upcoming appointments
SELECT *
FROM Appointment
WHERE appointment_date > NOW()
ORDER BY appointment_date;
